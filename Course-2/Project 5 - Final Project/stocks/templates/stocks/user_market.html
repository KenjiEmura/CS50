{% extends "stocks/layout.html" %}
{% load static %}
{% load humanize %}


{% block title %}
{{ title }}
{% endblock %}


{% block head %}
    <script src="{% static 'stocks/user_market.js' %}"></script>
    <script src="https://kit.fontawesome.com/ee07d0f153.js" crossorigin="anonymous"></script>
{% endblock %}


{% block body %}

    {% if messages %}
        {% for message in messages %}
        <div  {% if message.tags %} class=" {{ message.tags }} " {% endif %}> {{ message }} </div>
        {% endfor %}
    {% endif %}

    
    <div class='main-content'>
      
      <div class="whole-accordion">
    
        {% for id, value in users.items %}

          <div class="accordion">
            <div class="accordion__button">{{ id | title }}'s Stocks for Sale</div>
            <div class="accordion__content">
              <div class='table-container'>
                <table class="styled-table no-border-radius">
                    <thead class="">
                        <tr>
                            <th class='symbol'>Ticker</th>
                            <th>Company Name</th>
                            <th>Stocks Available</th>
                            <th>Unitary Price</th>
                            <th class='table-header-centered'>Purchase</th>
                        </tr>
                    </thead>
                    <tbody>

                    {% for stock_id, stock_info in value.items %}
                        {% if stock_info.qty > 0 and stock_info.for_sale %}
                        <tr class='stock-info'>
                            <input type="hidden" class='stock-id' value="{{ stock_id }}">
                            <td class='symbol'>{{ stock_info.symbol }}</td>
                            <td class='name'>{{ stock_info.name }}</td>
                            <td class='qty'>{{ stock_info.qty }}</td>
                            <td class='price'>{{ stock_info.market_price }}</td>
                            <td class='purchase'>
                              <input class='purchase-qty' type="number" min="0">
                              <button id="purchase">Buy</button>
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}

                    </tbody>
                  </table>
            </div>
            </div>
          </div>

        {% endfor %}

      </div>

        {% csrf_token %}

        <p>{{ users }}</p>

        {% for id, value in users.items %}
            <h3>Id: {{ id }}</h3>
            <p>Value: {{ value }}</p>
            <ul>
                {% for stock_id, stock_info in value.items%}
                    <li>{{ stock_info.qty }} stocks from {{ stock_info.name }} at this price: {{ stock_info.user_sell_price }}</li>
                {% endfor %}
            </ul>
        {% endfor %}

    </div>

{% endblock %}